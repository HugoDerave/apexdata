<div class="event-background">
  <div class="event-background__gradient-left"></div>
  <div class="event-background__gradient-top"></div>
  <div class="event-background__image">
    <%= image_tag("layout/event_bg.jpg") %>
  </div>
</div>

<div class="event-top <%= "event-top--soon" if DateTime.now < @event.start_datetime %>">
  <% if DateTime.now < @event.start_datetime %>
    <h1 class="event__top-title"><%= @event.title %></h1>
    <h3 class="event__top-subtitle">Event is starting in</h3>
    <div class="event__time-wrapper event__time-wrapper--large" data-current-time="<%= DateTime.now %>" data-start-time="<%= @event.start_datetime %>">
      <span class="event__time event__day">00</span>
      <span class="event__double">:</span>
      <span class="event__time event__hour">00</span>
      <span class="event__double">:</span>
      <span class="event__time event__min">00</span>
      <span class="event__double event__double--sec">:</span>
      <span class="event__time event__sec">00</span>
    </div>
  <% else %>
  <div class="event__flags">
    <div class="event-top__flag event-top__flag--second" style="background-image: url(<%= image_path "legends/bloodhound/banner.webp" %>)">
      <span class="flag__name">Mitsiee</span>
      <div class="flag__score">
        <div class="flag__badge">
          <span class="event__position">2</span>
          <%= inline_svg("badges/levels/top3_event.svg") %>
        </div>
        <div class="flag__eventscore">
          <span class="eventscore__name">Pistol Kills</span>
          <span class="eventscore__score">687</span>
        </div>
      </div>
    </div>
    <div class="event-top__flag event-top__flag--first" style="background-image: url(<%= image_path "legends/pathfinder/banner.webp" %>)">
      <span class="flag__name">GuardianXT705</span>
      <div class="flag__score">
        <div class="flag__badge">
          <span class="event__position">1</span>
          <%= inline_svg("badges/levels/top3_event.svg") %>
        </div>
        <div class="flag__eventscore">
          <span class="eventscore__name">Pistol Kills</span>
          <span class="eventscore__score">687</span>
        </div>
      </div>
    </div>
    <div class="event-top__flag event-top__flag--third" style="background-image: url(<%= image_path "legends/gibraltar/banner.webp" %>)">
      <span class="flag__name">Doldoc</span>
      <div class="flag__score">
        <div class="flag__badge">
          <span class="event__position">3</span>
          <%= inline_svg("badges/levels/top3_event.svg") %>
        </div>
        <div class="flag__eventscore">
          <span class="eventscore__name">Pistol Kills</span>
          <span class="eventscore__score">687</span>
        </div>
      </div>
    </div>
  </div>
  <% end %>
</div>

<div class="list-content">
  <aside class="list-content__sidebar">
    <div class="item item--list">
      <small class="event__small">Event</small>
      <div class="heading heading--event">
        <% if DateTime.now < @event.start_datetime %>
          <h2 class="heading__title heading__title--event"><%= @event.title %></h2>
        <% else %>
          <h1 class="heading__title heading__title--event"><%= @event.title %></h1>
        <% end %>
      </div>

      <% if current_user %>
        <% if current_user.claimed_profiles.any? %>
          <%= form_for :event_signup, url: event_signups_path, remote: true do |form| %>
            <% if current_user.claimed_profiles.where(checks_completed: 1).many? %>
              <div class="form-field">
                <%= form.label :profile_uid, "What profile would you like to join with?", class: "form-label" %>
                <%= form.select :profile_uid, current_user.claimed_profiles.where(checks_completed: 1).collect {|p| [p.username, p.profile_uid]} %>
                <div class="form-hint">Select the profile you would like to join with. You can join with multiple Profiles, but they will be counted seperately.</div>
              </div>
            <% else %>
              <%= form.hidden_field :profile_uid, value: current_user.claimed_profiles.first.profile_uid %>
            <% end %>

            <%= form.hidden_field :event_id, value: @event.id %>

            <%= form.submit "Sign up for event", class: "button" %>
          <% end %>
        <% end %>
      <% end %>

      <div class="top-offset">
        <% @event.event_signups.each do |event_signup| %>
          <%= event_signup.user_id %>: <%= event_signup.profile_uid %>
        <% end %>
      </div>
    </div>

    <div class="item item--list">
      <small class="event__small"><span><%= @event.start_datetime %></span> - <span><%= @event.end_datetime %></span></small>
      <div class="heading heading--event">
        <% if DateTime.now < @event.start_datetime %>
          <h2 class="heading__title heading__title--event">Starting soon</h2>
        <% else %>
          <h2 class="heading__title heading__title--event">Event ends in</h2>
        <% end %>
      </div>
      <% if DateTime.now > @event.start_datetime && DateTime.now < @event.end_datetime  %>
        <div class="event__time-wrapper" data-current-time="<%= DateTime.now %>" data-end-time="<%= @event.end_datetime %>">
          <span class="event__time event__day">00</span>
          <span class="event__double">:</span>
          <span class="event__time event__hour">00</span>
          <span class="event__double">:</span>
          <span class="event__time event__min">00</span>
          <span class="event__double event__double--sec">:</span>
          <span class="event__time event__sec">00</span>
        </div>
      <% else %>
        <div class="event__time-information">
          <span class="event__time event__info">Event starting soon</span>
        </div>
      <% end %>
    </div>

  </aside>

  <div class="list-content__content">
    <div class="item event__leaderboard">
      <% @event.event_signups.each_with_index do |event_signup, index| %>
        <%= render "leaderboard_item", event_signup: event_signup, item_counter: index + 1 %>
      <% end %>
    </div>
  </div>
</div>
