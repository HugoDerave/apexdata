<div class="event-top">
  <center><h2 class="event__top-subtitle"><%= @event.title %></h2></center>

  <div class="event__flags">
    <% sorted_event_signups = @event.event_signups.order(total_value: :desc) %>

    <% sorted_event_signups.limit(3).each_with_index do |event_signup, index| %>
      <%= render "flag_item", event_signup: event_signup, item_counter: index + 1 %>
    <% end %>
  </div>
</div>

<%= render "event_signups/update_leaderboard_item" if current_user && current_user.event_signups.where(event_id: @event.id).any? %>

<div class="list-content">
  <aside class="list-content__sidebar">
    <div class="item item--list item--event">
      <div class="heading mt-0 mb-20">
        <h4 class="heading__title"><%= @event.title %></h4>
      </div>

      <%= @event.description %>

      <hr>

      <%= render "event_signups/form" if DateTime.now.localtime < @event.end_datetime.localtime %>
      <%= render "current_position" if current_user %>
    </div>

    <div class="item item--list item--event">
      <% if DateTime.now.localtime < @event.end_datetime.localtime %>
        <div class="heading mt-0 mb-20">
          <h4 class="heading__title">Event ends in</h4>
        </div>

        <%= render "countdown", current_time: DateTime.now, end_time: @event.end_datetime %>

        <small>
          <span>Starts at: <%= @event.start_datetime.strftime("%e %B %Y, %T %Z") %></span><br>
          <span>Ends at: <%= @event.end_datetime.strftime("%e %B %Y, %T %Z") %></span>
        </small>
      <% else %>
        <h5 class="mt-0">This event has ended</h5>

        <small>
          <span>Started at: <%= @event.start_datetime.strftime("%e %B %Y, %T %Z") %></span><br>
          <span>Ended at: <%= @event.end_datetime.strftime("%e %B %Y, %T %Z") %></span>
        </small>
      <% end %>
    </div>

    <div class="item item--list item--event">
      <div class="heading mt-0 mb-20">
        <h4 class="heading__title">Rewards</h4>
      </div>

      <%= render "rewards" %>
    </div>
  </aside>

  <div class="list-content__content">
    <% if sorted_event_signups.any? %>
      <div class="item leaderboard" data-role="leaderboard">
        <% sorted_event_signups.each_with_index do |event_signup, index| %>
          <%= render "leaderboard_item", event_signup: event_signup, item_counter: index + 1 %>
        <% end %>
      </div>
    <% else %>
      <div class="item item--full-width"><center>There are not yet any signups</center></div>
    <% end %>
  </div>
</div>
